# SPDX-FileCopyrightText: Copyright 2024 LG Electronics Inc.
#
# SPDX-License-Identifier: Apache-2.0

# DO NOT USE this file if you can see this comment.

apiVersion: v1
kind: Pod
metadata:
  name: piccolo-player
spec:
  hostNetwork: true
  hostPid: true
  containers:
  - name: filtergateway
    image: ghcr.io/eclipse-pullpiri/pullpiri:$(VERSION)
    command: ["/piccolo/filtergateway"]
    environment:
    - name: ROCKSDB_SERVICE_URL
      value: "http://$(HOST_IP):50051"
    volumeMounts:
    - name: piccolo-yaml
      mountPath: /root/piccolo_yaml
    - name: config-path
      mountPath: /etc/piccolo/settings.yaml
  - name: actioncontroller
    image: ghcr.io/eclipse-pullpiri/pullpiri:$(VERSION)
    command: ["/piccolo/actioncontroller"]
    volumeMounts:
    - name: piccolo-yaml
      mountPath: /root/piccolo_yaml
    - name: dbus
      mountPath: /run/dbus
    - name: systemd
      mountPath: /etc/containers/systemd
    - name: config-path
      mountPath: /etc/piccolo/settings.yaml
    environment:
    - name: ROCKSDB_SERVICE_URL
      value: "http://$(HOST_IP):50051"
  - name: statemanager
    image: ghcr.io/eclipse-pullpiri/pullpiri:$(VERSION)
    command: ["/piccolo/statemanager"]
    volumeMounts:
    - name: piccolo-yaml
      mountPath: /root/piccolo_yaml
    - name: dbus
      mountPath: /run/dbus
    - name: systemd
      mountPath: /etc/containers/systemd
    - name: config-path
      mountPath: /etc/piccolo/settings.yaml
    environment:
    - name: ROCKSDB_SERVICE_URL
      value: "http://$(HOST_IP):50051"
  volumes:
  - name: piccolo-yaml
    hostPath:
      path: /etc/piccolo/yaml
  - name: dbus
    hostPath:
      path: /run/dbus
  - name: systemd
    hostPath:
      path: /etc/containers/systemd
  - name: config-path
    hostPath:
      path: /etc/containers/systemd/piccolo/settings.yaml
